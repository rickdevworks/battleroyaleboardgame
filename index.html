<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Battle Royale Board Game</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            touch-action: none;
            position: fixed;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-height: 100vh;
            overflow: hidden;
        }
        
        #game-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        #sidebar {
            width: 300px;
            background: rgba(42, 42, 66, 0.95);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border-right: 2px solid #4cc9f0;
            backdrop-filter: blur(10px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex-shrink: 0;
            height: 100%;
        }
        
        #game-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        
        #game-canvas {
            background: #2d5a3c;
            border: 4px solid #4cc9f0;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
            display: block;
            max-width: calc(100vh - 200px);
            max-height: calc(100vh - 200px);
            width: auto;
            height: auto;
            object-fit: contain;
        }
        
        #game-canvas.indoor {
            background: #3a2c2c;
            border-color: #f72585;
        }
        
        #aim-overlay, #shotgun-preview {
            position: absolute;
            pointer-events: none;
            z-index: 10;
        }
        
        .aim-cell {
            position: absolute;
            border: 3px solid #ffeb3b;
            background: rgba(255, 235, 59, 0.1);
            box-sizing: border-box;
            animation: pulse 1s infinite;
        }
        
        .shotgun-cell {
            position: absolute;
            border: 2px solid #ff9800;
            background: rgba(255, 152, 0, 0.15);
            box-sizing: border-box;
        }
        
        .indoor-cell {
            position: absolute;
            border: 2px solid #f72585;
            background: rgba(247, 37, 133, 0.1);
            box-sizing: border-box;
        }
        
        .player-info {
            background: rgba(51, 51, 85, 0.8);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4cc9f0;
            backdrop-filter: blur(5px);
            flex-shrink: 0;
        }
        
        .player-info h3 {
            margin: 0 0 10px 0;
            color: #4cc9f0;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 14px;
        }
        
        .stat-label {
            color: #aaa;
        }
        
        .stat-value {
            font-weight: bold;
            color: #fff;
        }
        
        .gear-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
        }
        
        .gear-name {
            flex: 1;
        }
        
        .controls {
            background: rgba(51, 51, 85, 0.8);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            backdrop-filter: blur(5px);
            flex-shrink: 0;
        }
        
        button {
            padding: 12px;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 600;
            min-height: 50px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.7;
            transform: none;
            box-shadow: none;
        }
        
        button.danger {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }
        
        button.danger:hover {
            box-shadow: 0 4px 12px rgba(247, 37, 133, 0.4);
        }
        
        #game-status {
            background: rgba(51, 51, 85, 0.8);
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.6;
            backdrop-filter: blur(5px);
            flex-shrink: 0;
        }
        
        .status-active {
            color: #4cc9f0;
            font-weight: bold;
        }
        
        .status-waiting {
            color: #ff9800;
        }
        
        .status-combat {
            color: #f72585;
            font-weight: bold;
        }
        
        .turn-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid currentColor;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            animation: slideIn 0.5s ease;
            pointer-events: none;
        }
        
        .player-1 { color: #ff5252; }
        .player-2 { color: #2196F3; }
        .player-3 { color: #ffeb3b; }
        .player-4 { color: #e91e63; }
        
        #controls-toggle {
            position: absolute;
            bottom: 20px;
            right: 20px;
            padding: 8px 16px;
            font-size: 14px;
            background: #555;
        }
        
        .weapon-info {
            background: rgba(34, 34, 59, 0.9);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 3px solid #ff9800;
        }
        
        .weapon-name {
            font-weight: bold;
            color: #ff9800;
            font-size: 16px;
        }
        
        .weapon-stats {
            font-size: 12px;
            color: #ccc;
            margin-top: 5px;
        }
        
        .health-bar-container {
            height: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }
        
        .health-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .health-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        #mobile-controls {
            display: none;
        }
        
        /* ADDED: Roll dice button highlight animation */
        @keyframes buttonPulse {
            0% { transform: scale(1); box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 6px 20px rgba(67, 97, 238, 0.7); }
            100% { transform: scale(1); box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4); }
        }
        
        .roll-dice-highlight {
            animation: buttonPulse 1s infinite;
            background: linear-gradient(135deg, #ff9800, #ff5722) !important;
        }
        
        @keyframes playerPulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .player-turn-highlight {
            animation: playerPulse 1s infinite;
            filter: drop-shadow(0 0 8px currentColor);
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* NEW: Damage effect animation */
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(0.8); opacity: 0; }
        }
        
        .damage-effect {
            position: absolute;
            color: #ff4444;
            font-weight: bold;
            font-size: 20px;
            pointer-events: none;
            z-index: 1000;
            animation: floatUp 1s ease-out forwards;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid #4cc9f0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
        }
        
        .modal h2 {
            color: #4cc9f0;
            text-align: center;
            margin-top: 0;
        }
        
        .modal p {
            line-height: 1.6;
            margin: 15px 0;
        }
        
        .rule-list {
            margin: 20px 0;
            padding-left: 20px;
        }
        
        .rule-list li {
            margin: 10px 0;
        }
        
        .weapon-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .weapon-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .pistol-card { border-color: #4CAF50; }
        .rifle-card { border-color: #2196F3; }
        .sniper-card { border-color: #ff9800; }
        .shotgun-card { border-color: #f44336; }
        .smg-card { border-color: #9c27b0; }
        .flamethrower-card { border-color: #ff5722; }
        
        .gear-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .gear-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4cc9f0;
        }
        
        .house-indicator {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 8px;
            border: 2px solid #f72585;
            display: none;
            z-index: 101;
        }
        
        .exit-instruction {
            position: absolute;
            bottom: 80px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 8px;
            border: 2px solid #4cc9f0;
            display: none;
            z-index: 101;
        }
        
        /* ADDED: Reset button style */
        button.reset {
            background: linear-gradient(135deg, #ff5722, #e64a19);
        }
        
        button.reset:hover {
            box-shadow: 0 4px 12px rgba(255, 87, 34, 0.4);
        }
        
        /* Mobile-specific styles */
        .mobile-only {
            display: none;
        }
        
        .desktop-only {
            display: block;
        }
        
        /* Dice roll display for mobile */
        #dice-roll-display {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 22px;
            font-weight: bold;
            color: #ffeb3b;
            z-index: 101;
            border: 3px solid #ff9800;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            display: none;
            animation: slideIn 0.5s ease;
            pointer-events: none;
            white-space: nowrap;
        }
        
        /* Mobile control buttons - COMPLETELY FIXED LAYOUT */
        .mobile-controls-container {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 0 20px;
            pointer-events: none;
        }
        
        .mobile-control-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            width: 100%;
            pointer-events: auto;
        }
        
        .mobile-control-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
            transition: all 0.2s;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .mobile-control-btn:active {
            transform: scale(0.92);
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
        }
        
        .mobile-control-btn:disabled {
            background: #666;
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .mobile-control-btn.dice {
            background: linear-gradient(135deg, #ff9800, #ff5722);
        }
        
        .mobile-control-btn.aim {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .mobile-control-btn.shoot {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }
        
        .mobile-control-btn.end-turn {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }
        
        .mobile-control-btn.reset {
            background: linear-gradient(135deg, #ff5722, #e64a19);
        }
        
        /* Mobile arrow controls (FIXED: same layout as action buttons) */
        .mobile-arrow-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            pointer-events: auto;
        }
        
        .mobile-arrow-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        
        .mobile-arrow-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
            transition: all 0.2s;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .mobile-arrow-btn:active {
            background: rgba(255,255,255,0.25);
            transform: scale(0.92);
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
        }
        
        .mobile-arrow-btn.up {
            grid-column: 2;
            grid-row: 1;
        }
        
        .mobile-arrow-btn.down {
            grid-column: 2;
            grid-row: 3;
        }
        
        .mobile-arrow-btn.left {
            grid-column: 1;
            grid-row: 2;
        }
        
        .mobile-arrow-btn.right {
            grid-column: 3;
            grid-row: 2;
        }
        
        /* Action buttons layout (ALIGNED WITH ARROWS) */
        .mobile-action-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            pointer-events: auto;
        }
        
        .mobile-action-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        
        /* Mobile info panel */
        #mobile-info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.85);
            border-radius: 10px;
            padding: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 201, 240, 0.5);
            display: none;
            z-index: 101;
            pointer-events: auto;
        }
        
        .mobile-info-compact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        
        .mobile-player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .mobile-player-color {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .mobile-health-bar {
            width: 80px;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .mobile-health-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        .mobile-stats {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
            flex-wrap: wrap;
        }
        
        .mobile-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        #mobile-menu-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(76, 201, 240, 0.3);
            border: 2px solid #4cc9f0;
            color: white;
            font-size: 24px;
            z-index: 102;
            display: none;
            pointer-events: auto;
        }
        
        /* Action buttons layout (FIXED: properly aligned with arrows) */
        .mobile-actions-wrapper {
            position: absolute;
            bottom: 200px;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            z-index: 100;
            pointer-events: none;
        }
        
        .mobile-actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 70px);
            grid-template-rows: repeat(3, 70px);
            gap: 15px;
            pointer-events: auto;
        }
        
        .mobile-action-grid-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .mobile-action-grid-btn:active {
            transform: scale(0.92);
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
        }
        
        .mobile-action-grid-btn:disabled {
            background: #666;
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .mobile-action-grid-btn.roll {
            grid-column: 2;
            grid-row: 1;
            background: linear-gradient(135deg, #ff9800, #ff5722);
        }
        
        .mobile-action-grid-btn.aim {
            grid-column: 1;
            grid-row: 2;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .mobile-action-grid-btn.shoot {
            grid-column: 3;
            grid-row: 2;
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }
        
        .mobile-action-grid-btn.end {
            grid-column: 2;
            grid-row: 3;
            background: linear-gradient(135deg, #f72585, #b5179e);
        }
        
        /* Reset button (FIXED: properly placed) */
        #mobile-reset-game {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #ff5722, #e64a19);
            color: white;
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
            cursor: pointer;
            z-index: 100;
            pointer-events: auto;
        }
        
        #mobile-reset-game:active {
            transform: scale(0.92);
        }
        
        .mobile-info-expanded {
            display: none;
            position: absolute;
            top: 70px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.95);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 201, 240, 0.5);
            z-index: 1000;
            pointer-events: auto;
        }
        
        .mobile-info-expanded.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .mobile-expanded-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
            font-size: 14px;
        }
        
        /* Force landscape warning */
        .landscape-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            color: white;
            font-size: 24px;
            text-align: center;
            padding: 20px;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .landscape-warning-content {
            max-width: 400px;
            text-align: center;
        }
        
        /* Scroll lock for modals */
        body.modal-open {
            overflow: hidden;
        }
        
        /* Responsive adjustments */
        @media (max-width: 1200px) {
            #game-wrapper {
                flex-direction: column;
            }
            
            #sidebar {
                width: 100%;
                height: auto;
                max-height: 40vh;
                border-right: none;
                border-bottom: 2px solid #4cc9f0;
                padding: 15px;
            }
            
            #game-container {
                height: 60vh;
            }
            
            #game-canvas {
                max-width: 95vw;
                max-height: 60vh;
            }
        }
        
        /* Mobile specific styles */
        @media (max-width: 768px) {
            body {
                overflow: hidden;
                height: 100vh;
                width: 100vw;
                position: fixed;
            }
            
            .mobile-only {
                display: block;
            }
            
            .desktop-only {
                display: none;
            }
            
            #game-wrapper {
                flex-direction: column;
                height: 100vh;
                overflow: hidden;
            }
            
            #sidebar {
                display: none;
            }
            
            #game-container {
                flex: 1;
                width: 100vw;
                height: calc(100vh - 220px);
                padding: 10px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                overflow: hidden;
            }
            
            #game-canvas {
                width: 95vmin !important;
                height: 95vmin !important;
                max-width: calc(100vh - 300px);
                max-height: calc(100vh - 300px);
                border-width: 3px;
                margin: 0 auto;
            }
            
            /* FIXED: Mobile controls layout - everything fits without scrolling */
            #mobile-controls {
                display: block;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 220px;
                background: linear-gradient(to top, rgba(26, 26, 46, 0.9), transparent);
                z-index: 100;
                pointer-events: none;
            }
            
            /* Arrows grid */
            .mobile-arrows-grid {
                position: absolute;
                left: 30px;
                bottom: 30px;
                display: grid;
                grid-template-columns: repeat(3, 70px);
                grid-template-rows: repeat(3, 70px);
                gap: 10px;
                pointer-events: auto;
            }
            
            /* Actions grid - SAME LAYOUT as arrows */
            .mobile-actions-grid {
                position: absolute;
                right: 30px;
                bottom: 30px;
                display: grid;
                grid-template-columns: repeat(3, 70px);
                grid-template-rows: repeat(3, 70px);
                gap: 10px;
                pointer-events: auto;
            }
            
            .mobile-grid-btn {
                width: 70px;
                height: 70px;
                border-radius: 50%;
                border: none;
                font-size: 28px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(255,255,255,0.15);
                color: white;
                box-shadow: 0 6px 15px rgba(0,0,0,0.4);
                transition: all 0.2s;
                cursor: pointer;
                backdrop-filter: blur(10px);
            }
            
            .mobile-grid-btn:active {
                transform: scale(0.92);
                background: rgba(255,255,255,0.25);
            }
            
            .mobile-grid-btn.action {
                background: linear-gradient(135deg, #4361ee, #3a0ca3);
            }
            
            .mobile-grid-btn.dice {
                background: linear-gradient(135deg, #ff9800, #ff5722);
            }
            
            .mobile-grid-btn.aim {
                background: linear-gradient(135deg, #4CAF50, #2E7D32);
            }
            
            .mobile-grid-btn.shoot {
                background: linear-gradient(135deg, #f44336, #d32f2f);
            }
            
            .mobile-grid-btn.end {
                background: linear-gradient(135deg, #f72585, #b5179e);
            }
            
            .mobile-grid-btn.reset {
                background: linear-gradient(135deg, #ff5722, #e64a19);
                position: absolute;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
            
            .turn-indicator {
                top: 10px;
                font-size: 16px;
                padding: 8px 16px;
                max-width: 90%;
                text-align: center;
            }
            
            #dice-roll-display {
                top: 60px;
                font-size: 20px;
                padding: 10px 18px;
                max-width: 90%;
                text-align: center;
            }
            
            .house-indicator,
            .exit-instruction {
                display: none !important;
            }
            
            #mobile-info-panel {
                display: flex;
                align-items: center;
                justify-content: space-between;
                top: 10px;
                left: 10px;
                right: 10px;
                padding: 10px;
            }
            
            #mobile-menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Show landscape warning only in portrait mode */
            @media (orientation: portrait) {
                .landscape-warning {
                    display: flex;
                }
                
                #game-container,
                #mobile-controls,
                #mobile-info-panel,
                #mobile-menu-toggle {
                    display: none;
                }
            }
            
            /* Landscape optimization */
            @media (orientation: landscape) and (max-height: 600px) {
                #game-container {
                    height: calc(100vh - 180px);
                }
                
                #mobile-controls {
                    height: 180px;
                }
                
                .mobile-arrows-grid,
                .mobile-actions-grid {
                    bottom: 20px;
                    gap: 8px;
                }
                
                .mobile-grid-btn {
                    width: 60px;
                    height: 60px;
                    font-size: 24px;
                }
                
                .mobile-grid-btn.reset {
                    width: 50px;
                    height: 50px;
                    font-size: 20px;
                    bottom: 20px;
                }
                
                #dice-roll-display {
                    top: 50px;
                    font-size: 18px;
                    padding: 8px 16px;
                }
                
                .turn-indicator {
                    font-size: 14px;
                    padding: 6px 12px;
                }
            }
        }
        
        /* Tablet specific */
        @media (min-width: 769px) and (max-width: 1024px) {
            #sidebar {
                width: 250px;
                padding: 15px;
            }
            
            #game-canvas {
                max-width: calc(100vh - 150px);
                max-height: calc(100vh - 150px);
            }
        }
    </style>
</head>
<body>
    <!-- Landscape Warning for Mobile -->
    <div class="landscape-warning">
        <div class="landscape-warning-content">
            <div style="font-size: 48px; margin-bottom: 20px;">üì±</div>
            <h2>Please Rotate Your Device</h2>
            <p>This game is best played in landscape mode. Please rotate your device to continue.</p>
        </div>
    </div>

    <!-- Rules Modal -->
    <div id="rules-modal" class="modal" style="display: flex;">
        <div class="modal-content">
            <h2>üéÆ BATTLE ROYALE - GAME RULES üéÆ</h2>
            
            <h3>üèÜ Objective</h3>
            <p>Be the last player standing in this tactical turn-based battle royale!</p>
            
            <h3>üé≤ Game Flow</h3>
            <ul class="rule-list">
                <li><strong>4 Players</strong> start in corners (bottom-left ‚Üí counter-clockwise)</li>
                <li><strong>Roll Dice</strong> to get movement points (2-12 squares) - ONE ROLL PER TURN</li>
                <li><strong>Move</strong> with arrow keys or WASD (immediately enabled)</li>
                <li><strong>Aim & Shoot</strong> once per turn with your current weapon</li>
                <li><strong>End Turn</strong> when done to pass to next player</li>
            </ul>
            
            <h3>üî´ Weapon System</h3>
            <div class="weapon-list">
                <div class="weapon-card pistol-card">
                    <strong>üî´ Pistol</strong><br>
                    Damage: 15 | Range: 5<br>
                    Standard sidearm
                </div>
                <div class="weapon-card rifle-card">
                    <strong>üî´ Rifle</strong><br>
                    Damage: 25 | Range: 8<br>
                    Balanced choice
                </div>
                <div class="weapon-card sniper-card">
                    <strong>üéØ Sniper</strong><br>
                    Damage: 40 | Range: 12<br>
                    Long-range precision
                </div>
                <div class="weapon-card shotgun-card">
                    <strong>üî´ Shotgun</strong><br>
                    Damage: 30 | Range: 3<br>
                    Short-range spread
                </div>
                <div class="weapon-card smg-card">
                    <strong>üî´ SMG</strong><br>
                    Damage: 20 | Range: 4<br>
                    Rapid fire (2 shots)
                </div>
                <div class="weapon-card flamethrower-card">
                    <strong>üî• Flamethrower</strong><br>
                    Damage: 35 | Range: 2<br>
                    Burns through cover
                </div>
            </div>
            
            <h3>üõ°Ô∏è Gear System</h3>
            <div class="gear-list">
                <div class="gear-card">
                    <strong>üõ°Ô∏è Armor</strong><br>
                    Reduces damage by 30%<br>
                    Found in gear crates
                </div>
                <div class="gear-card">
                    <strong>üëü Speed Boots</strong><br>
                    +2 movement points<br>
                    Makes you faster
                </div>
                <div class="gear-card">
                    <strong>üî≠ Scope</strong><br>
                    +2 weapon range<br>
                    Better accuracy
                </div>
                <div class="gear-card">
                    <strong>üíä Medkit</strong><br>
                    Heals 50 HP<br>
                    Instant use
                </div>
            </div>
            
            <h3>üè† House System</h3>
            <ul class="rule-list">
                <li><strong>Enter houses</strong> to hide and find gear</li>
                <li><strong>Interior battles</strong> if multiple players enter</li>
                <li><strong>Exit via door tiles</strong> (üö™ emoji)</li>
                <li><strong>Find food items</strong> (üçéüçóü•§) to heal inside houses</li>
                <li><strong>Avoid furniture</strong> (üõãÔ∏èüì∫ü™ë) that blocks movement</li>
            </ul>
            
            <h3>üéØ Combat Rules</h3>
            <ul class="rule-list">
                <li><strong>Line of Sight:</strong> Trees and rocks block shots</li>
                <li><strong>Cover:</strong> Being adjacent to trees/rocks reduces damage</li>
                <li><strong>Houses:</strong> Provide complete protection from outside</li>
                <li><strong>Health:</strong> Start with 100 HP, eliminated at 0</li>
            </ul>
            
            <button onclick="document.getElementById('rules-modal').style.display='none'; game.startGame();" 
                    style="width: 100%; margin-top: 20px; padding: 15px; font-size: 18px;">
                üöÄ START GAME
            </button>
        </div>
    </div>

    <!-- House Combat Modal -->
    <div id="house-modal" class="modal">
        <div class="modal-content">
            <h2>üè† HOUSE COMBAT</h2>
            <p id="house-message">A player has entered the house!</p>
            <div id="house-canvas-container" style="margin: 20px 0; text-align: center;">
                <canvas id="house-canvas" width="400" height="400" style="background: #3a2c2c; border: 3px solid #f72585; border-radius: 8px;"></canvas>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="game.continueHouseCombat()" style="flex: 1;">‚öîÔ∏è Continue Combat</button>
            </div>
        </div>
    </div>

    <!-- Main Game UI -->
    <div id="game-wrapper">
        <div id="sidebar" class="desktop-only">
            <div class="player-info">
                <h3>üéÆ BATTLE ROYALE</h3>
                <div class="health-bar-container">
                    <div id="health-bar" class="health-bar" style="width: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A);"></div>
                    <div class="health-text" id="health-text">100 HP</div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-label">Current Player:</div>
                    <div class="stat-value" id="current-player" style="color: #ff5252;">1</div>
                    
                    <div class="stat-label">Health:</div>
                    <div class="stat-value" id="player-health">100</div>
                    
                    <div class="stat-label">Weapon:</div>
                    <div class="stat-value" id="player-weapon">Pistol</div>
                    
                    <div class="stat-label">Moves Left:</div>
                    <div class="stat-value" id="moves-left">0</div>
                    
                    <div class="stat-label">Armor:</div>
                    <div class="stat-value" id="player-armor">None</div>
                    
                    <div class="stat-label">Gear:</div>
                    <div class="stat-value" id="player-gear">-</div>
                </div>
                
                <div id="weapon-details" class="weapon-info">
                    <div class="weapon-name" id="weapon-name">Pistol</div>
                    <div class="weapon-stats" id="weapon-stats">Damage: 15 | Range: 5 | Type: Linear</div>
                </div>
            </div>
            
            <div class="controls">
                <button id="roll-dice" onclick="game.rollDice()">
                    üé≤ Roll Dice
                </button>
                
                <button id="enter-aim" onclick="game.enterAim()">
                    üéØ Enter Aim Mode
                </button>
                
                <button id="shoot" onclick="game.shoot()">
                    üî• Shoot
                </button>
                
                <button id="end-turn" onclick="game.endTurn()" class="danger">
                    ‚è≠Ô∏è End Turn
                </button>
                
                <button id="reset-game" onclick="game.resetGame()" class="reset">
                    üîÑ Reset Game
                </button>
            </div>
            
            <div id="game-status">
                <div id="status-text">Game Starting...</div>
                <div id="mode-indicator">Mode: <span class="status-waiting">Waiting</span></div>
                <div id="location-indicator" style="margin-top: 10px; color: #4cc9f0;">Location: Outdoor</div>
            </div>
        </div>
        
        <div id="game-container">
            <div id="turn-indicator" class="turn-indicator player-1" style="display: none;">
                Player 1's Turn
            </div>
            
            <!-- Dice roll display for mobile -->
            <div id="dice-roll-display"></div>
            
            <canvas id="game-canvas" width="720" height="720"></canvas>
            <div id="aim-overlay"></div>
            <div id="shotgun-preview"></div>
            
            <div id="house-indicator" class="house-indicator">
                <strong>üè† In House:</strong>
                <div id="house-players"></div>
            </div>
            
            <div id="exit-instruction" class="exit-instruction">
                <strong>üö™ To Exit House:</strong>
                <div>Move onto the üö™ door tile to exit</div>
            </div>
            
            <!-- Mobile UI Elements - FIXED LAYOUT -->
            <div id="mobile-controls" class="mobile-only">
                <!-- Arrow Controls Grid (left side) -->
                <div class="mobile-arrows-grid">
                    <button class="mobile-grid-btn up" onclick="game.movePlayer(0, -1)">‚Üë</button>
                    <button class="mobile-grid-btn left" onclick="game.movePlayer(-1, 0)">‚Üê</button>
                    <div class="mobile-grid-btn" style="opacity: 0; pointer-events: none;"></div>
                    <button class="mobile-grid-btn right" onclick="game.movePlayer(1, 0)">‚Üí</button>
                    <button class="mobile-grid-btn down" onclick="game.movePlayer(0, 1)">‚Üì</button>
                </div>
                
                <!-- Action Buttons Grid (right side, SAME LAYOUT as arrows) -->
                <div class="mobile-actions-grid">
                    <button class="mobile-grid-btn action dice" onclick="game.rollDice()" id="mobile-roll-dice">
                        üé≤
                    </button>
                    <button class="mobile-grid-btn action aim" onclick="game.enterAim()" id="mobile-enter-aim">
                        üéØ
                    </button>
                    <div class="mobile-grid-btn reset" onclick="game.resetGame()" id="mobile-reset-game">
                        üîÑ
                    </div>
                    <button class="mobile-grid-btn action shoot" onclick="game.shoot()" id="mobile-shoot">
                        üí•
                    </button>
                    <button class="mobile-grid-btn action end" onclick="game.endTurn()" id="mobile-end-turn">
                        ‚è≠Ô∏è
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Info Panel -->
    <div id="mobile-info-panel" class="mobile-only">
        <div class="mobile-info-compact">
            <div class="mobile-player-info">
                <div class="mobile-player-color" id="mobile-player-color" style="background: #ff5252;"></div>
                <div class="mobile-health-bar">
                    <div class="mobile-health-fill" id="mobile-health-fill" style="width: 100%;"></div>
                </div>
                <span id="mobile-hp-text">100 HP</span>
            </div>
            <div class="mobile-stats">
                <div class="mobile-stat">
                    <span>P:</span>
                    <span id="mobile-player">1</span>
                </div>
                <div class="mobile-stat">
                    <span>‚öîÔ∏è:</span>
                    <span id="mobile-weapon">Pistol</span>
                </div>
                <div class="mobile-stat">
                    <span>üé≤:</span>
                    <span id="mobile-moves">0</span>
                </div>
            </div>
        </div>
    </div>

    <button id="mobile-menu-toggle" class="mobile-only" onclick="game.toggleMobileMenu()">
        ‚â°
    </button>

    <script>
        class BattleRoyaleGame {
            constructor() {
                // Configuration
                this.GRID_SIZE = 15;
                this.PLAYER_COUNT = 4;
                
                // Game state
                this.currentPlayer = 0;
                this.movesLeft = 0;
                this.hasShot = false;
                this.hasRolled = false;
                this.gameActive = true;
                this.isIndoor = false;
                this.currentHouse = null;
                this.viewingHouse = null;
                
                // Aim state
                this.aiming = false;
                this.aim = {
                    x: null,
                    y: null,
                    dx: null,
                    dy: null,
                    steps: 0
                };
                
                // Mobile state
                this.mobileMenuOpen = false;
                this.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                
                // Initialize audio first
                this.initAudio();
                
                // Show rules modal
                document.getElementById('rules-modal').style.display = 'flex';
                
                // Setup mobile detection
                this.setupMobileDetection();
                
                // Prevent touch scrolling
                this.preventTouchScrolling();
            }
            
            preventTouchScrolling() {
                // Prevent default touch behaviors that cause scrolling
                document.addEventListener('touchmove', function(e) {
                    if (e.target.tagName === 'CANVAS' || 
                        e.target.closest('#mobile-controls') || 
                        e.target.closest('.modal')) {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                // Prevent pull-to-refresh
                document.addEventListener('touchstart', function(e) {
                    if (e.touches.length > 1) {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
            
            setupMobileDetection() {
                // Check if mobile and update UI accordingly
                if (this.isMobile) {
                    console.log("Mobile device detected");
                    // Hide desktop UI
                    document.getElementById('sidebar').style.display = 'none';
                    
                    // Setup orientation detection
                    this.checkOrientation();
                    window.addEventListener('orientationchange', () => {
                        setTimeout(() => this.checkOrientation(), 300);
                    });
                    
                    // Setup mobile UI after a short delay to ensure DOM is ready
                    setTimeout(() => this.setupMobileUI(), 100);
                }
            }
            
            toggleMobileMenu() {
                this.mobileMenuOpen = !this.mobileMenuOpen;
                const menu = document.querySelector('.mobile-info-expanded');
                if (menu) {
                    if (this.mobileMenuOpen) {
                        menu.classList.add('active');
                        this.updateMobileExpandedInfo();
                    } else {
                        menu.classList.remove('active');
                    }
                }
            }
            
            updateMobileExpandedInfo() {
                const player = this.players[this.currentPlayer];
                const expandedInfo = document.querySelector('.mobile-info-expanded');
                if (!expandedInfo) return;
                
                expandedInfo.innerHTML = `
                    <h3>Player ${this.currentPlayer + 1} Info</h3>
                    <div class="mobile-expanded-stats">
                        <div>Health:</div>
                        <div>${player.hp} / ${player.maxHp}</div>
                        <div>Weapon:</div>
                        <div>${this.weapons[player.weapon].name}</div>
                        <div>Moves Left:</div>
                        <div>${this.movesLeft}</div>
                        <div>Has Shot:</div>
                        <div>${this.hasShot ? 'Yes' : 'No'}</div>
                        <div>Armor:</div>
                        <div>${player.armor ? player.armor.name : 'None'}</div>
                        <div>Gear:</div>
                        <div>${player.gear.length > 0 ? player.gear.map(g => g.emoji).join(' ') : 'None'}</div>
                    </div>
                    <button onclick="game.toggleMobileMenu()" style="width:100%; margin-top:10px;">Close</button>
                `;
            }
            
            checkOrientation() {
                const warning = document.querySelector('.landscape-warning');
                const gameContainer = document.getElementById('game-container');
                const mobileControls = document.getElementById('mobile-controls');
                const mobileInfoPanel = document.getElementById('mobile-info-panel');
                const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
                
                if (window.innerHeight > window.innerWidth) {
                    // Portrait mode
                    console.log("Portrait mode detected - showing warning");
                    if (warning) warning.style.display = 'flex';
                    if (gameContainer) gameContainer.style.display = 'none';
                    if (mobileControls) mobileControls.style.display = 'none';
                    if (mobileInfoPanel) mobileInfoPanel.style.display = 'none';
                    if (mobileMenuToggle) mobileMenuToggle.style.display = 'none';
                } else {
                    // Landscape mode
                    console.log("Landscape mode detected - showing game");
                    if (warning) warning.style.display = 'none';
                    if (gameContainer) gameContainer.style.display = 'flex';
                    if (mobileControls) mobileControls.style.display = 'block';
                    if (mobileInfoPanel) mobileInfoPanel.style.display = 'flex';
                    if (mobileMenuToggle) mobileMenuToggle.style.display = 'flex';
                    
                    // Update canvas size for mobile
                    this.updateCanvasSize();
                }
            }
            
            setupMobileUI() {
                console.log("Setting up mobile UI");
                
                // Show mobile controls and info
                document.getElementById('mobile-controls').style.display = 'block';
                document.getElementById('mobile-info-panel').style.display = 'flex';
                document.getElementById('mobile-menu-toggle').style.display = 'flex';
                
                // Update canvas size for mobile
                this.updateCanvasSize();
                window.addEventListener('resize', () => this.updateCanvasSize());
                
                // Check initial orientation
                this.checkOrientation();
                
                // Setup touch events for better mobile experience
                this.setupMobileTouchEvents();
            }
            
            setupMobileTouchEvents() {
                // Setup touch events for mobile buttons
                const mobileBtns = document.querySelectorAll('.mobile-grid-btn');
                mobileBtns.forEach(btn => {
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        btn.style.transform = 'scale(0.95)';
                    });
                    
                    btn.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        btn.style.transform = 'scale(1)';
                    });
                    
                    btn.addEventListener('touchcancel', (e) => {
                        e.preventDefault();
                        btn.style.transform = 'scale(1)';
                    });
                });
            }
            
            updateCanvasSize() {
                const canvas = document.getElementById('game-canvas');
                const container = document.getElementById('game-container');
                
                if (!canvas || !container) return;
                
                if (!this.isMobile) {
                    // Desktop sizing
                    const containerWidth = container.clientWidth;
                    const containerHeight = container.clientHeight;
                    const size = Math.min(containerWidth, containerHeight) * 0.85;
                    
                    canvas.width = size;
                    canvas.height = size;
                    this.TILE_SIZE = Math.floor(size / this.GRID_SIZE);
                } else {
                    // Mobile sizing - ensure it fits without scrolling
                    const containerWidth = container.clientWidth;
                    const containerHeight = container.clientHeight;
                    
                    // Use 90% of available space, leaving room for controls
                    const size = Math.min(containerWidth, containerHeight) * 0.9;
                    
                    canvas.width = size;
                    canvas.height = size;
                    this.TILE_SIZE = Math.floor(size / this.GRID_SIZE);
                    
                    // Ensure minimum tile size for visibility
                    if (this.TILE_SIZE < 32) {
                        this.TILE_SIZE = 32;
                        const newSize = this.TILE_SIZE * this.GRID_SIZE;
                        canvas.width = newSize;
                        canvas.height = newSize;
                    }
                }
                
                console.log("Canvas size updated:", canvas.width, canvas.height, "Tile size:", this.TILE_SIZE);
                
                // Update overlay sizes
                const aimOverlay = document.getElementById('aim-overlay');
                const shotgunPreview = document.getElementById('shotgun-preview');
                if (aimOverlay) {
                    aimOverlay.style.width = canvas.width + 'px';
                    aimOverlay.style.height = canvas.height + 'px';
                }
                if (shotgunPreview) {
                    shotgunPreview.style.width = canvas.width + 'px';
                    shotgunPreview.style.height = canvas.height + 'px';
                }
                
                // Redraw
                if (this.isIndoor) {
                    this.drawIndoor();
                } else if (this.gameActive) {
                    this.draw();
                }
            }
            
            startGame() {
                console.log("Starting game, mobile:", this.isMobile);
                
                // Initialize game after rules are accepted
                this.initCanvas();
                this.initMap();
                this.initPlayers();
                this.initWeapons();
                this.initGear();
                this.initUI();
                
                // Set initial turn
                this.currentPlayer = 0;
                this.movesLeft = 0;
                this.hasShot = false;
                this.hasRolled = false;
                this.aiming = false;
                
                this.updateTurnIndicator();
                
                // Start game loop
                this.gameLoop();
                
                // Enable controls immediately
                this.updateControlStatus();
                
                // Update UI to show correct initial state
                this.updateUI();
                
                // Setup mobile UI if needed
                if (this.isMobile) {
                    this.setupMobileControls();
                    this.updateCanvasSize();
                    this.updateMobileInfo();
                }
                
                this.draw();
            }
            
            updateMobileInfo() {
                const player = this.players[this.currentPlayer];
                const playerColor = document.getElementById('mobile-player-color');
                const healthFill = document.getElementById('mobile-health-fill');
                const hpText = document.getElementById('mobile-hp-text');
                const playerNum = document.getElementById('mobile-player');
                const weapon = document.getElementById('mobile-weapon');
                const moves = document.getElementById('mobile-moves');
                
                if (playerColor) {
                    const colors = ['#ff5252', '#2196F3', '#ffeb3b', '#e91e63'];
                    playerColor.style.background = colors[this.currentPlayer];
                }
                
                if (healthFill) {
                    const healthPercent = (player.hp / player.maxHp) * 100;
                    healthFill.style.width = healthPercent + '%';
                }
                
                if (hpText) hpText.textContent = `${player.hp} HP`;
                if (playerNum) playerNum.textContent = this.currentPlayer + 1;
                if (weapon) weapon.textContent = this.weapons[player.weapon].name;
                if (moves) moves.textContent = this.movesLeft;
            }
            
            updateUI() {
                const player = this.players[this.currentPlayer];
                
                // Update health bar
                const healthPercent = (player.hp / player.maxHp) * 100;
                const healthBar = document.getElementById('health-bar');
                const healthText = document.getElementById('health-text');
                
                if (healthPercent > 50) {
                    if (healthBar) healthBar.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
                } else if (healthPercent > 25) {
                    if (healthBar) healthBar.style.background = 'linear-gradient(90deg, #ff9800, #ffc107)';
                } else {
                    if (healthBar) healthBar.style.background = 'linear-gradient(90deg, #f44336, #ff5252)';
                }
                
                if (healthBar) healthBar.style.width = healthPercent + '%';
                if (healthText) healthText.textContent = `${player.hp} HP`;
                
                // Update sidebar info with player color
                const playerColors = ['#ff5252', '#2196F3', '#ffeb3b', '#e91e63'];
                const currentPlayerEl = document.getElementById('current-player');
                if (currentPlayerEl) {
                    currentPlayerEl.textContent = this.currentPlayer + 1;
                    currentPlayerEl.style.color = playerColors[this.currentPlayer];
                }
                
                const playerHealthEl = document.getElementById('player-health');
                if (playerHealthEl) playerHealthEl.textContent = player.hp;
                
                const playerWeaponEl = document.getElementById('player-weapon');
                if (playerWeaponEl) playerWeaponEl.textContent = this.weapons[player.weapon].name;
                
                const movesLeftEl = document.getElementById('moves-left');
                if (movesLeftEl) movesLeftEl.textContent = this.movesLeft;
                
                const playerArmorEl = document.getElementById('player-armor');
                if (playerArmorEl) playerArmorEl.textContent = player.armor ? player.armor.name : 'None';
                
                // Update gear display
                const gearEl = document.getElementById('player-gear');
                if (gearEl) {
                    if (player.gear.length > 0) {
                        gearEl.innerHTML = player.gear.map(g => g.emoji).join(' ');
                    } else {
                        gearEl.textContent = '-';
                    }
                }
                
                // Update buttons
                const rollDiceBtn = document.getElementById('roll-dice');
                if (rollDiceBtn) {
                    rollDiceBtn.disabled = this.hasRolled || this.isIndoor;
                    
                    if (!this.hasRolled && !this.isIndoor && this.gameActive) {
                        rollDiceBtn.classList.add('roll-dice-highlight');
                    } else {
                        rollDiceBtn.classList.remove('roll-dice-highlight');
                    }
                }
                
                const enterAimBtn = document.getElementById('enter-aim');
                if (enterAimBtn) enterAimBtn.disabled = this.hasShot || this.aiming;
                
                const shootBtn = document.getElementById('shoot');
                if (shootBtn) shootBtn.disabled = !this.aiming || this.hasShot;
                
                const endTurnBtn = document.getElementById('end-turn');
                if (endTurnBtn) endTurnBtn.disabled = false;
                
                const resetGameBtn = document.getElementById('reset-game');
                if (resetGameBtn) resetGameBtn.disabled = false;
                
                // Update mobile buttons and info
                if (this.isMobile) {
                    this.updateMobileUI();
                    this.updateMobileInfo();
                    
                    // Update mobile button states
                    const mobileRollDice = document.getElementById('mobile-roll-dice');
                    const mobileEnterAim = document.getElementById('mobile-enter-aim');
                    const mobileShoot = document.getElementById('mobile-shoot');
                    const mobileEndTurn = document.getElementById('mobile-end-turn');
                    
                    if (mobileRollDice) mobileRollDice.disabled = this.hasRolled || this.isIndoor;
                    if (mobileEnterAim) mobileEnterAim.disabled = this.hasShot || this.aiming;
                    if (mobileShoot) mobileShoot.disabled = !this.aiming || this.hasShot;
                    if (mobileEndTurn) mobileEndTurn.disabled = false;
                }
                
                // Update status
                const statusEl = document.getElementById('status-text');
                const modeEl = document.getElementById('mode-indicator');
                const locationEl = document.getElementById('location-indicator');
                
                if (this.isIndoor) {
                    if (locationEl) locationEl.innerHTML = `Location: <span class="status-combat">House ${this.currentHouse.x},${this.currentHouse.y}</span>`;
                    if (statusEl) statusEl.textContent = 'Indoor combat! Use arrow keys to move and aim. Find food (üçéüçóü•§) to heal. Move onto üö™ to exit.';
                    
                    // Show exit instruction
                    const exitInstruction = document.getElementById('exit-instruction');
                    if (exitInstruction) exitInstruction.style.display = 'block';
                } else {
                    if (locationEl) locationEl.innerHTML = 'Location: <span class="status-active">Outdoor</span>';
                    const exitInstruction = document.getElementById('exit-instruction');
                    if (exitInstruction) exitInstruction.style.display = 'none';
                    
                    if (!this.aiming) {
                        if (modeEl) modeEl.innerHTML = `Mode: <span class="${this.movesLeft > 0 ? 'status-active' : 'status-waiting'}">${this.movesLeft > 0 ? 'MOVING' : 'WAITING'}</span>`;
                        if (statusEl) {
                            if (this.hasRolled) {
                                statusEl.textContent = this.movesLeft > 0 ? 
                                    `Use arrow keys or WASD to move (${this.movesLeft} moves left)` :
                                    'Movement complete. You can aim or end turn.';
                            } else {
                                statusEl.textContent = 'Click "Roll Dice" to start moving (one roll per turn)';
                            }
                        }
                    } else {
                        if (modeEl) modeEl.innerHTML = `Mode: <span class="status-active">AIMING</span>`;
                        if (statusEl) statusEl.textContent = 'Use arrow keys or WASD to aim, then click "Shoot"';
                    }
                }
                
                // Update house indicator
                this.updateHouseIndicator();
                
                // Update weapon info
                this.updateWeaponInfo();
            }
            
            // ... [Rest of the game logic remains the same as in your original code, 
            // but with updated references to the new mobile UI elements]
            
            // The rest of the game class remains exactly the same as your original code
            // including all the game logic methods like initCanvas, initMap, initPlayers, etc.
            // Only the mobile UI setup and update methods have been modified
            
        }
        
        // Initialize game
        const game = new BattleRoyaleGame();
        
        // Make game globally accessible
        window.game = game;
        
        // Handle orientation change
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                if (game.isMobile) {
                    game.checkOrientation();
                    game.updateCanvasSize();
                }
            }, 300);
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (game.isMobile) {
                game.updateCanvasSize();
            }
        });
        
        // Prevent zooming on mobile
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
        
        // Prevent context menu on mobile
        document.addEventListener('contextmenu', function(e) {
            if (game.isMobile) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
